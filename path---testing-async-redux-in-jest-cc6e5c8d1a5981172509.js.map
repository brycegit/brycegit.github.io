{"version":3,"sources":["webpack:///path---testing-async-redux-in-jest-cc6e5c8d1a5981172509.js","webpack:///./.cache/json/testing-async-redux-in-jest.json"],"names":["webpackJsonp","409","module","exports","data","site","siteMetadata","title","author","markdownRemark","id","html","frontmatter","date","pathContext","slug","previous","fields","next"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,eAAAC,OAAA,iBAAgDC,gBAAmBC,GAAA,kIAAAC,KAAA,opjBAA8xkBC,aAA4JL,MAAA,uCAAAM,KAAA,qBAA0EC,aAAgBC,KAAA,gCAAAC,UAAmDC,QAAUF,KAAA,YAAkBH,aAAgBL,MAAA,+BAAsCW,MAASD,QAAUF,KAAA,iCAAuCH,aAAgBL,MAAA","file":"path---testing-async-redux-in-jest-cc6e5c8d1a5981172509.js","sourcesContent":["webpackJsonp([222316504281121],{\n\n/***/ 409:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Bryce's Blog\",\"author\":\"Bryce Dooley\"}},\"markdownRemark\":{\"id\":\"/Users/brycedooley/Documents/blog/gatsby-blog/src/pages/testing-async-redux-in-jest/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>In this article I’ll outline two approaches that have worked well for me when testing React component logic that is tied to async Redux actions.</p>\\n<p>An example of this would be a <code class=\\\"language-text\\\">&lt;Search /&gt;</code> component that calls a search service and displays results. I’ll use this example in the code below.</p>\\n<h2>The Problem</h2>\\n<p>When functionality of React components is closely coupled with Redux actions/reducers and API calls, they become a bit harder to test than a standalone component. Ideally you want to test the integration of the component, the Redux ecosystem and the asynchronous API calls (this most closely resembles the end user’s experience). But unless you have a working API some mocking will need to happen.</p>\\n<h2>The Solution</h2>\\n<p>As I’ll explain below, the solutions I’ve found to work well are 1) mocking the Redux actions that trigger async API calls, and 2) mocking the API calls themselves. This allows you to test the interface of the React component without needing an actual API to return results.</p>\\n<h2>Mocking Redux Actions</h2>\\n<h3>The Test</h3>\\n<p>Here is a basic example of what a <code class=\\\"language-text\\\">&lt;Search /&gt;</code> test might look like:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// search-test.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> setup <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./setup'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'should send correct search params to API on submit'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> submitButton<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">,</span> actions <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Let's assume the search form already </span>\\n  <span class=\\\"token comment\\\">// has the search values in place.</span>\\n  fireEvent<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">click</span><span class=\\\"token punctuation\\\">(</span>submitButton<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>actions<span class=\\\"token punctuation\\\">.</span>search<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toHaveBeenCalledWith</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<h2>The Setup</h2>\\n<p>This file allows you to export the rendered <code class=\\\"language-text\\\">&lt;Search /&gt;</code> component integrated with a Redux store, along with mocked Redux actions. While this could live in the test file, I prefer to keep them separate for greater reusability. </p>\\n<p>Your actual setup may need to change based on your test lib; I had <a href=\\\"https://github.com/testing-library/react-testing-library\\\">React Testing Library</a> in mind when writing this.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// setup.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> createStore <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Provider <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'react-redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> render <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'your-testing-lib'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> actions <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> reducer <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/reducer'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> Search <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/component'</span><span class=\\\"token punctuation\\\">;</span>\\n\\njest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mock</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    search<span class=\\\"token punctuation\\\">:</span> jest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">fn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// It is common for an action to return a higher order </span>\\n      <span class=\\\"token comment\\\">// function that exposes \\\"dispatch\\\", especially when</span>\\n      <span class=\\\"token comment\\\">// using redux-thunk. To keep the tests synchronous</span>\\n      <span class=\\\"token comment\\\">// we'll just return an object.</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// Note: the type string must be entered</span>\\n        <span class=\\\"token comment\\\">// manually vs importing a constant, due</span>\\n        <span class=\\\"token comment\\\">// to jest.mock being hoisted</span>\\n        type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'SUBMIT_SEARCH'</span><span class=\\\"token punctuation\\\">,</span>\\n        payload<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>somePayload <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  initialState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someInitialState <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> testingLibFns <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">render</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&lt;</span>Provider store<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token function\\\">createStore</span><span class=\\\"token punctuation\\\">(</span>reducer<span class=\\\"token punctuation\\\">,</span> initialState<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token operator\\\">&lt;</span>Search <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">/</span>Provider<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">...</span>testingLibFns<span class=\\\"token punctuation\\\">,</span>\\n    params<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someSearchParams <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    submitButton<span class=\\\"token punctuation\\\">:</span> testingLibFns<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Submit'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    actions\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This setup will allow you to test your component and a portion of the Redux integration, without needing to deal with a real API or async code. </p>\\n<h2>Mocking API Calls</h2>\\n<h3>The Test</h3>\\n<p>Another good way of testing the integration of components, Redux and API is by mocking the API calls instead of Redux actions. Here is an example of mocking axios:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// mock-api-test.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> axios <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'axios'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> setup <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./setup'</span><span class=\\\"token punctuation\\\">;</span>\\n\\njest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mock</span><span class=\\\"token punctuation\\\">(</span>axios<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">afterAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  jest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">restoreAllMocks</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'should render correct search results'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> submitButton<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">,</span> actions<span class=\\\"token punctuation\\\">,</span> getByText <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">await</span> axios<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mockResolvedValue</span><span class=\\\"token punctuation\\\">(</span>someResponse<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Let's assume the search form already </span>\\n  <span class=\\\"token comment\\\">// has the search values in place.</span>\\n  fireEvent<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">click</span><span class=\\\"token punctuation\\\">(</span>submitButton<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span>someResponse<span class=\\\"token punctuation\\\">.</span>values<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<h3>The Setup</h3>\\n<p>The setup file would need to be slightly different when mocking the API since you’ll need your async Redux actions to remain in place, so we will not mock them. This typically means you’ll need to add your Redux middleware to the fake Redux store:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// setup.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> createStore <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Provider <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'react-redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> render <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'your-testing-lib'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> actions <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> reducer <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/reducer'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> Search <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/component'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> middleware <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../redux-middleware'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  initialState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someInitialState <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> testingLibFns <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">render</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&lt;</span>Provider store<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token function\\\">createStore</span><span class=\\\"token punctuation\\\">(</span>reducer<span class=\\\"token punctuation\\\">,</span> initialState<span class=\\\"token punctuation\\\">,</span> middleware<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token operator\\\">&lt;</span>Search <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">/</span>Provider<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">...</span>testingLibFns<span class=\\\"token punctuation\\\">,</span>\\n    params<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someSearchParams <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    submitButton<span class=\\\"token punctuation\\\">:</span> testingLibFns<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Submit'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    actions\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>If you have other ideas or thoughts <a href=\\\"https://twitter.com/BryceDooley\\\">let me know!</a></p>\",\"frontmatter\":{\"title\":\"Testing async React Redux using Jest\",\"date\":\"August 18, 2019\"}}},\"pathContext\":{\"slug\":\"/testing-async-redux-in-jest/\",\"previous\":{\"fields\":{\"slug\":\"/es2019/\"},\"frontmatter\":{\"title\":\"A quick overview of ES2019\"}},\"next\":{\"fields\":{\"slug\":\"/creating-useObservable-hook/\"},\"frontmatter\":{\"title\":\"Creating a useObservable React Hook\"}}}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---testing-async-redux-in-jest-cc6e5c8d1a5981172509.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Bryce's Blog\",\"author\":\"Bryce Dooley\"}},\"markdownRemark\":{\"id\":\"/Users/brycedooley/Documents/blog/gatsby-blog/src/pages/testing-async-redux-in-jest/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>In this article I’ll outline two approaches that have worked well for me when testing React component logic that is tied to async Redux actions.</p>\\n<p>An example of this would be a <code class=\\\"language-text\\\">&lt;Search /&gt;</code> component that calls a search service and displays results. I’ll use this example in the code below.</p>\\n<h2>The Problem</h2>\\n<p>When functionality of React components is closely coupled with Redux actions/reducers and API calls, they become a bit harder to test than a standalone component. Ideally you want to test the integration of the component, the Redux ecosystem and the asynchronous API calls (this most closely resembles the end user’s experience). But unless you have a working API some mocking will need to happen.</p>\\n<h2>The Solution</h2>\\n<p>As I’ll explain below, the solutions I’ve found to work well are 1) mocking the Redux actions that trigger async API calls, and 2) mocking the API calls themselves. This allows you to test the interface of the React component without needing an actual API to return results.</p>\\n<h2>Mocking Redux Actions</h2>\\n<h3>The Test</h3>\\n<p>Here is a basic example of what a <code class=\\\"language-text\\\">&lt;Search /&gt;</code> test might look like:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// search-test.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> setup <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./setup'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'should send correct search params to API on submit'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> submitButton<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">,</span> actions <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Let's assume the search form already </span>\\n  <span class=\\\"token comment\\\">// has the search values in place.</span>\\n  fireEvent<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">click</span><span class=\\\"token punctuation\\\">(</span>submitButton<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">expect</span><span class=\\\"token punctuation\\\">(</span>actions<span class=\\\"token punctuation\\\">.</span>search<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toHaveBeenCalledWith</span><span class=\\\"token punctuation\\\">(</span>params<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<h2>The Setup</h2>\\n<p>This file allows you to export the rendered <code class=\\\"language-text\\\">&lt;Search /&gt;</code> component integrated with a Redux store, along with mocked Redux actions. While this could live in the test file, I prefer to keep them separate for greater reusability. </p>\\n<p>Your actual setup may need to change based on your test lib; I had <a href=\\\"https://github.com/testing-library/react-testing-library\\\">React Testing Library</a> in mind when writing this.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// setup.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> createStore <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Provider <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'react-redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> render <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'your-testing-lib'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> actions <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> reducer <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/reducer'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> Search <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/component'</span><span class=\\\"token punctuation\\\">;</span>\\n\\njest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mock</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    search<span class=\\\"token punctuation\\\">:</span> jest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">fn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// It is common for an action to return a higher order </span>\\n      <span class=\\\"token comment\\\">// function that exposes \\\"dispatch\\\", especially when</span>\\n      <span class=\\\"token comment\\\">// using redux-thunk. To keep the tests synchronous</span>\\n      <span class=\\\"token comment\\\">// we'll just return an object.</span>\\n      <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// Note: the type string must be entered</span>\\n        <span class=\\\"token comment\\\">// manually vs importing a constant, due</span>\\n        <span class=\\\"token comment\\\">// to jest.mock being hoisted</span>\\n        type<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'SUBMIT_SEARCH'</span><span class=\\\"token punctuation\\\">,</span>\\n        payload<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>somePayload <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  initialState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someInitialState <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> testingLibFns <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">render</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&lt;</span>Provider store<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token function\\\">createStore</span><span class=\\\"token punctuation\\\">(</span>reducer<span class=\\\"token punctuation\\\">,</span> initialState<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token operator\\\">&lt;</span>Search <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">/</span>Provider<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">...</span>testingLibFns<span class=\\\"token punctuation\\\">,</span>\\n    params<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someSearchParams <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    submitButton<span class=\\\"token punctuation\\\">:</span> testingLibFns<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Submit'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    actions\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>This setup will allow you to test your component and a portion of the Redux integration, without needing to deal with a real API or async code. </p>\\n<h2>Mocking API Calls</h2>\\n<h3>The Test</h3>\\n<p>Another good way of testing the integration of components, Redux and API is by mocking the API calls instead of Redux actions. Here is an example of mocking axios:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// mock-api-test.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> axios <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'axios'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> setup <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'./setup'</span><span class=\\\"token punctuation\\\">;</span>\\n\\njest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mock</span><span class=\\\"token punctuation\\\">(</span>axios<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">afterAll</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  jest<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">restoreAllMocks</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token function\\\">test</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'should render correct search results'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">{</span> submitButton<span class=\\\"token punctuation\\\">,</span> params<span class=\\\"token punctuation\\\">,</span> actions<span class=\\\"token punctuation\\\">,</span> getByText <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">await</span> axios<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">mockResolvedValue</span><span class=\\\"token punctuation\\\">(</span>someResponse<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// Let's assume the search form already </span>\\n  <span class=\\\"token comment\\\">// has the search values in place.</span>\\n  fireEvent<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">click</span><span class=\\\"token punctuation\\\">(</span>submitButton<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span>someResponse<span class=\\\"token punctuation\\\">.</span>values<span class=\\\"token punctuation\\\">[</span><span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></code></pre>\\n      </div>\\n<h3>The Setup</h3>\\n<p>The setup file would need to be slightly different when mocking the API since you’ll need your async Redux actions to remain in place, so we will not mock them. This typically means you’ll need to add your Redux middleware to the fake Redux store:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-js\\\"><code class=\\\"language-js\\\"><span class=\\\"token comment\\\">// setup.js</span>\\n\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> createStore <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> Provider <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'react-redux'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> render <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'your-testing-lib'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> actions <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/actions'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> reducer <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/reducer'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> Search <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../search/component'</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">import</span> middleware <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'../redux-middleware'</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">setup</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  initialState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someInitialState <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> testingLibFns <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">render</span><span class=\\\"token punctuation\\\">(</span>\\n    <span class=\\\"token operator\\\">&lt;</span>Provider store<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">{</span><span class=\\\"token function\\\">createStore</span><span class=\\\"token punctuation\\\">(</span>reducer<span class=\\\"token punctuation\\\">,</span> initialState<span class=\\\"token punctuation\\\">,</span> middleware<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">></span>\\n      <span class=\\\"token operator\\\">&lt;</span>Search <span class=\\\"token operator\\\">/</span><span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token operator\\\">&lt;</span><span class=\\\"token operator\\\">/</span>Provider<span class=\\\"token operator\\\">></span>\\n  <span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token operator\\\">...</span>testingLibFns<span class=\\\"token punctuation\\\">,</span>\\n    params<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>someSearchParams <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n    submitButton<span class=\\\"token punctuation\\\">:</span> testingLibFns<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getByText</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Submit'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    actions\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span> \\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>If you have other ideas or thoughts <a href=\\\"https://twitter.com/BryceDooley\\\">let me know!</a></p>\",\"frontmatter\":{\"title\":\"Testing async React Redux using Jest\",\"date\":\"August 18, 2019\"}}},\"pathContext\":{\"slug\":\"/testing-async-redux-in-jest/\",\"previous\":{\"fields\":{\"slug\":\"/es2019/\"},\"frontmatter\":{\"title\":\"A quick overview of ES2019\"}},\"next\":{\"fields\":{\"slug\":\"/creating-useObservable-hook/\"},\"frontmatter\":{\"title\":\"Creating a useObservable React Hook\"}}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/testing-async-redux-in-jest.json\n// module id = 409\n// module chunks = 222316504281121"],"sourceRoot":""}